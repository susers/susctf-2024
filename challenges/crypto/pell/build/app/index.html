<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUSCTF Task</title>
    <link rel="stylesheet" href="/static/water.min.css">
    <script src="" type="module"></script>
</head>
<body>
    <h3>Pell</h3>
    <p>æ‰¾åˆ°ä¸‹é¢æ–¹ç¨‹çš„ä¸€ç»„æ­£æ•´æ•°è§£å³å¯è·å¾— flag:</p>
    <p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block">  <msup>    <mi>a</mi>    <mn>2</mn>  </msup>  <mo>&#x2212;</mo>  <mn>114514</mn>  <mo>&#x2217;</mo>  <msup>    <mi>b</mi>    <mn>2</mn>  </msup>  <mo>=</mo>  <mn>1</mn></math></p>
    <h3>æäº¤ç­”æ¡ˆ</h3>
    <blockquote>ç‚¹å‡»â€œæäº¤â€æŒ‰é’®åéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´</blockquote>
    <form>
        <label for="token">
            é˜Ÿä¼ token
            <a onclick="document.getElementById('dialog').showModal()">è¿™æ˜¯ä»€ä¹ˆ</a>
        </label>
        <input id="token" type="text" placeholder="è¯·è¾“å…¥é˜Ÿä¼ token">
        <label for="int-a">a</label>
        <input id="int-a" type="text" placeholder="è¯·è¾“å…¥æ­£æ•´æ•° a">
        <label for="int-b">b</label>
        <input id="int-b" type="text" placeholder="è¯·è¾“å…¥æ­£æ•´æ•° b">
        <button id="submit">æäº¤</button>
        <div id="rate"></div>
        <progress id="progress" value="0" max="100" hidden> 0% </progress> 
        <strong id="result"></strong>
    </form>
    <dialog id="dialog" style="max-width: 500px;">
        <header>å…³äºé˜Ÿä¼ token</header>
        <form method="dialog">
            <p>é˜Ÿä¼ token ç”±é˜Ÿä¼ id åŠè¢« Base64 ç¼–ç çš„ ed25519 ç­¾åç»„æˆï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªåˆæ³•çš„é˜Ÿä¼ token ç¤ºä¾‹ï¼š</p>
            <code>1201:HCdjp352NcQoL/4gS8RP3xRt5B9xX2V4m2UeoqfM2dxcLrI5FiYQ7HC9pqreG+tudWjYJf0atzQhhAKyYDKsCg==</code>
            <blockquote style="font-style: normal;">âš ï¸ é˜Ÿä¼ token ç”¨äºè¯æ˜ä½ çš„èº«ä»½ï¼Œè¯·ä¸è¦å‘å…¶ä»–äººæä¾›</blockquote>
            <blockquote style="font-style: normal;">
                ğŸ’¡ ä½ å¯ä»¥åœ¨
                <a href="https://ctf.seusus.com/games/1/challenges" target="_blank">æ¯”èµ›é¡µé¢</a>
                å³ä¾§æ‰¾åˆ°ä½ çš„é˜Ÿä¼ token ğŸ”‘
            </blockquote>
            <menu style="float:right">
                <button value="ok">OK</button>
            </menu>
        </form>
    </dialog>
    <script type="module">
        import { caculateProof, submitAnswer } from "/static/susctf-helper.js";

        const button = document.getElementById("submit")
        const progress = document.getElementById("progress")
        const rate = document.getElementById("rate")
        const result = document.getElementById("result")
        
        button.addEventListener("click", getFlag)
        async function getFlag() {
            result.innerText = ""
            button.disabled = true
            button.innerText = "æäº¤ä¸­..."
            const answer = {
                "a": document.getElementById("int-a").value,
                "b": document.getElementById("int-b").value
            }
            const token = document.getElementById("token").value
            const beginTime = new Date().getTime()
            const proof = await caculateProof(answer, token, (v) => {
                if (v == -1) {
                    progress.hidden = true
                } else {
                    progress.value = v*100
                }
            }, (v) => {
                rate.innerText = "Rate: " + v + "k hashes/s"
            })
            console.log(proof)
            const elapsedTime = new Date().getTime() - beginTime
            rate.innerText = "Time: " + elapsedTime + "ms"
            try {
                const req = await submitAnswer(answer, proof, token)
                if (req.data) {
                    result.innerText = req.data
                    result.style.color = "green"
                } else {
                    result.innerText = req.error
                    result.style.color = "red"
                }

            } catch (e) {
                console.error(e)
            } finally {
                button.disabled = false
                button.innerText = "æäº¤"
                progress.hidden = true
            }
        }
    </script>
</body>
</html>