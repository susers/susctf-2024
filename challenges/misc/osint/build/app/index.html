<!doctype html>
<html lang="zh-cn">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>SUSCTF Task</title>
        <link rel="stylesheet" href="/static/water.min.css" />
        <script src="" type="module"></script>
    </head>

    <body>
        <h3>osint signin</h3>
        <img src="static/pic.jpg" />
        <h3>æäº¤ç­”æ¡ˆ</h3>
        <blockquote>ç‚¹å‡»â€œæäº¤â€æŒ‰é’®åéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´</blockquote>
        <form>
            <label for="token">
                é˜Ÿä¼ token
                <a onclick="document.getElementById('dialog').showModal()"
                    >è¿™æ˜¯ä»€ä¹ˆ</a
                >
            </label>
            <input id="token" type="text" placeholder="è¯·è¾“å…¥é˜Ÿä¼ token" />
            <label for="a1">èˆªç­å·</label>

            <input id="a1" type="text" placeholder="è¯·è¾“å…¥èˆªç­å·ï¼ˆå¤§å†™ï¼‰" />
            <label for="a2">æ²³æµåç§°</label>
            <input id="a2" type="text" placeholder="è¯·è¾“å…¥å›¾ç‰‡ä¸­æ²³æµçš„åç§°" />
            <button id="submit">æäº¤</button>
            <div id="rate"></div>
            <progress id="progress" value="0" max="100" hidden>0%</progress>
            <strong id="result"></strong>
        </form>
        <dialog id="dialog" style="max-width: 500px">
            <header>å…³äºé˜Ÿä¼ token</header>
            <form method="dialog">
                <p>
                    é˜Ÿä¼ token ç”±é˜Ÿä¼ id åŠè¢« Base64 ç¼–ç çš„ ed25519
                    ç­¾åç»„æˆï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªåˆæ³•çš„é˜Ÿä¼ token ç¤ºä¾‹ï¼š
                </p>
                <code
                    >1201:HCdjp352NcQoL/4gS8RP3xRt5B9xX2V4m2UeoqfM2dxcLrI5FiYQ7HC9pqreG+tudWjYJf0atzQhhAKyYDKsCg==</code
                >
                <blockquote style="font-style: normal">
                    âš ï¸ é˜Ÿä¼ token ç”¨äºè¯æ˜ä½ çš„èº«ä»½ï¼Œè¯·ä¸è¦å‘å…¶ä»–äººæä¾›
                </blockquote>
                <blockquote style="font-style: normal">
                    ğŸ’¡ ä½ å¯ä»¥åœ¨
                    <a
                        href="https://ctf.seusus.com/games/1/challenges"
                        target="_blank"
                        >æ¯”èµ›é¡µé¢</a
                    >
                    å³ä¾§æ‰¾åˆ°ä½ çš„é˜Ÿä¼ token ğŸ”‘
                </blockquote>
                <menu style="float: right">
                    <button value="ok">OK</button>
                </menu>
            </form>
        </dialog>
        <script type="module">
            import {
                caculateProof,
                submitAnswer,
            } from "/static/susctf-helper.js";

            const button = document.getElementById("submit");
            const progress = document.getElementById("progress");
            const rate = document.getElementById("rate");
            const result = document.getElementById("result");

            button.addEventListener("click", getFlag);
            async function getFlag() {
                result.innerText = "";
                button.disabled = true;
                button.innerText = "æäº¤ä¸­...";
                const answer = {
                    a1: document.getElementById("a1").value,
                    a2: document.getElementById("a2").value,
                };
                const token = document.getElementById("token").value;
                const beginTime = new Date().getTime();
                const proof = await caculateProof(
                    answer,
                    token,
                    (v) => {
                        if (v == -1) {
                            progress.hidden = true;
                        } else {
                            progress.value = v * 100;
                        }
                    },
                    (v) => {
                        rate.innerText = "Rate: " + v + "k hashes/s";
                    },
                );
                console.log(proof);
                const elapsedTime = new Date().getTime() - beginTime;
                rate.innerText = "Time: " + elapsedTime + "ms";
                try {
                    const req = await submitAnswer(answer, proof, token);
                    if (req.data) {
                        result.innerText = req.data;
                        result.style.color = "green";
                    } else {
                        result.innerText = req.error;
                        result.style.color = "red";
                    }
                } catch (e) {
                    console.error(e);
                } finally {
                    button.disabled = false;
                    button.innerText = "æäº¤";
                    progress.hidden = true;
                }
            }
        </script>
    </body>
</html>
